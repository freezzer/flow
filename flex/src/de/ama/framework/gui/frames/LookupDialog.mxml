<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
                layout="absolute" width="332" height="260"
                title="Suche" showCloseButton="true"
                backgroundColor="#C0C0C0"
                close="close()"
                cornerRadius="4"
         xmlns:ns1="de.ama.framework.gui.frames.*"
        >

    <mx:Script><![CDATA[
        import de.ama.framework.data.BoReference;
        import de.ama.framework.data.SelectionModel;
        import de.ama.framework.util.Callback;
        import de.ama.services.Factory;

        import mx.managers.PopUpManager;

        //        private function init():void {
        //            getListPanel().reload();
        //        }

        private var _listpane:ListPanel;
        private var _lister:String = "default";

        private var _callback:Callback = null;
        private var _boRef:BoReference = null;

        public function setCallback(cb:Callback):void {
            _callback = cb;
        }

        private function callback():void {
            if (_callback != null) {
                _callback.execute(this);
            }
        }

        public function close():void {
            PopUpManager.removePopUp(this);
            callback();
        }

        public function keyHandler(e:KeyboardEvent):void {
        }

        public function inputHandler(e:Event):void {
        }

        private function onListDoubleClick(lp:ListPanel):void {
            okButtonHandler();
        }

        private function okButtonHandler():void {
            var sm:SelectionModel = getListPanel().getSelectionModel();
            _boRef = sm.getFirstSelection();
            close();
        }

        public function geLister():String {
            return _lister;
        }

        public function setLister(value:String):void {
            _lister = value;
        }

        public function get selection():BoReference {
            return _boRef;
        }

        public function getListPanel():ListPanel {
            if (_listpane == null) {
                _listpane = Factory.createLister(_lister);
            }
            if(cp.getChildren().length<3){
                _listpane.doubleClickCallback = new Callback(this, onListDoubleClick);
                cp.addChildAt(_listpane, 1);
            }
            return _listpane;
        }


        public function setListPanel(lp:ListPanel):void {
            _listpane = lp;
        }

        public function reload():void{
            getListPanel().reload();
        }
        
        ]]></mx:Script>


    <mx:VBox id="cp" width="100%" verticalGap="1" verticalAlign="bottom" height="100%">
        <mx:TextInput width="100%" id="input" change="inputHandler(event)"/>


        <mx:HBox width="100%" bottom="0" horizontalAlign="right" horizontalGap="0">
            <mx:Button label="ok" click="okButtonHandler()"/>
            <mx:Button label="close" click="close()"/>
        </mx:HBox>
    </mx:VBox>

</mx:TitleWindow>
